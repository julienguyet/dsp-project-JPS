# This is a guide to install airflow using Astro CLI
# Astro CLI is a solution to orchestrate airflow with docker

# 1. Install Docker
# Go to https://www.docker.com/get-started/ and follow instructions based on your OS

# 2. Install Astro
# Go to below link and follow instructions based on your OS. Once installation is finished move to step 3. 
https://docs.astronomer.io/astro/cli/install-cli

# 3. Move to your repo directory (dsp-project-JPS) and at the root, in terminal, do:
mkdir airflow
cd airflow

# 4. Initialize Airflow:
astro dev init
ls
# you should now see new files and folders added to the airflow directory. 
# by default astro will add the airflow folder to the .gitignore file

# 5. Create the Airflow DAG:
# Go to the 'dags' folder and save here the 'dsp_dag.py' file (available at: dsp-project-JPS/gx/validation_job)

# 6. Create data directory:
# still in dags folder run:
mkdir raw_data
mkdir good_data
mkdir bad_data

# 7. Generate files:
# from the notebooks folder, execute the 'generate_files_final' notebook
# now you should have partitions in your raw_data folder

# 8. Define requirements:
# open the requirements.txt file in the airflow folder and add the below line:
great-expectations==0.18.12

# 9. Start airflow:
# from airflow folder run in your terminal:
astro dev start

# it might takes several minutes the first time as astro will initialize 

# 10. Airflow UI will open in your browser
# check that the 'data_validation_dag' is listed in your DAGS
# trigger it manually and wait for the success status

# 11. Stop airflow:
# simply run:
asro dev stop

# Ok now you can launch airflow at anytime by executing 'astro dev start' =)


